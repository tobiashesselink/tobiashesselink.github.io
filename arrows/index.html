<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arrows</title>
</head>
<body>

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-app.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="index.css">

<script>

    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDkc-UuO3DKmPRaSdy8yvH72IgiWA6346c",
        authDomain: "arrowsgame-6eb49.firebaseapp.com",
        databaseURL: "https://arrowsgame-6eb49.firebaseio.com",
        projectId: "arrowsgame-6eb49",
        storageBucket: "arrowsgame-6eb49.appspot.com",
        messagingSenderId: "992545119460"
    };
    firebase.initializeApp(config);

    // Get a reference to the database service
    var database = firebase.database();
    console.log("Retreiving users from database");

    // List with users
    var users = [];

    // Read data
    database.ref('/users/').orderByChild('leaderboard_highscore').limitToLast(100).once('value').then(function (snapshot) {
        snapshot.forEach(function (childSnapshot) {

            var childData = childSnapshot.val();
            // console.log(childData)
            users.push({username: childData.username, highscore: childData.leaderboard_highscore})

        });

        // Data retrieved from db
        console.log("Retrieved users");

        // Sort the list based on highscores
        users.sort(function (a, b) {
            return b.highscore - a.highscore;
        })

        // Show data
        var elList = document.getElementById('leaderboard');
        elList.innerHTML = ``;
        var high_label = document.getElementById("highscore_label");
        var user_label = document.getElementById("username_label");

        // Loop through the users and add html parts to the list
        for (var i = 0; i < users.length; i++) {
            let obj = users[i];
            elList.innerHTML += `<div class="row justify-content-md-center">
            <div class="col col-lg-2 blocklb" id="highscore_label">${obj.highscore}</div>
            <div class="col col-lg-3 blocklb" id="username_label">${obj.username}</div>
        </div>`

        }
    });

</script>

<div class="container" style="background-color: white; margin-top: 30px">
    <div class="row justify-content-md-center">
        <div style="font-size: 75px">Soon online..</div>
    </div>
    <div class="row justify-content-md-center">
    <div style="font-size: 30px">Coming leaderboards for Arrows</div>
    </div>
    <div class="row justify-content-md-center">
    <a href="itms-services://?action=download-manifest&url=https://tobiashesselink.nl/arrows/app.plist"
       style="font-size: 30px">Download App</a>
    </div>
</div>
<div class="container" style="background-color: white; margin-top: 50px" id="leaderboard">
    <!-- Content for leaderboard -->
    <div class="row justify-content-md-center">Loading...</div>
</div>

</body>
</html>