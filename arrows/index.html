<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arrows</title>
</head>
<body>

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-app.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-database.js"></script>

<!-- Link stylesheets-->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="index.css">

<!-- BODY -->
<div class="page_wrapper">
    <header class="head group">
        <div class="head_wrapper group">
            <div class="logo"><h1>Arrows leaderboard</h1></div>
        </div>
    </header>
    <div class="banner">
        <div class="wrapper">
            <div class="banner_content">
                <div class="banner_wrapper">
                    <div class="container">
                        <h2 class="title"><img src="http://findicons.com/files/icons/2799/flat_icons/256/trophy.png">
                            TOP 100 LEADERBOARD</h2>
                        <ol id="board" class="leaderboard">
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDkc-UuO3DKmPRaSdy8yvH72IgiWA6346c",
        authDomain: "arrowsgame-6eb49.firebaseapp.com",
        databaseURL: "https://arrowsgame-6eb49.firebaseio.com",
        projectId: "arrowsgame-6eb49",
        storageBucket: "arrowsgame-6eb49.appspot.com",
        messagingSenderId: "992545119460"
    };
    firebase.initializeApp(config);

    // Get a reference to the database service
    var database = firebase.database();
    console.log("Retreiving users from database");

    // List with users
    var users = [];

    // Set loading sign
    document.getElementById('board').innerHTML = `
    <div class="row justify-content-md-center">Loading...</div>
    `

    // Read data
    database.ref('/users/').orderByChild('leaderboard_highscore').limitToLast(100).once('value').then(function (snapshot) {
        snapshot.forEach(function (childSnapshot) {

            var childData = childSnapshot.val();
            // console.log(childData)
            users.push({username: childData.username, highscore: childData.leaderboard_highscore});
        });

        // Data retrieved from db
        console.log("Retrieved users");

        // Sort the list based on highscores
        users.sort(function (a, b) {
            return b.highscore - a.highscore;
        });

        // Position number
        var x;

        // Just before we load the data into the html, remove the loading sign
        document.getElementById('board').innerHTML = ``;

        // Show data in the leaderboard
        for (x in users) {
            document.getElementById('board').innerHTML +=
                '<li class="rank">' +
                '<h2 class="name">'
                + users[x].username +
                '</h2>' +
                '<strong class="pts">'
                + users[x].highscore +
                '</strong></li>';
        }

        // // Show data
        // var elList = document.getElementById('leaderboard');
        // elList.innerHTML = ``;
        // var high_label = document.getElementById("highscore_label");
        // var user_label = document.getElementById("username_label");
        //
        // // Loop through the users and add html parts to the list
        // for (var i = 0; i < users.length; i++) {
        //     let obj = users[i];
        //     elList.innerHTML += `<div class="row justify-content-md-center">
        //     <div class="col col-lg-2 blocklb" id="highscore_label">${obj.highscore}</div>
        //     <div class="col col-lg-3 blocklb" id="username_label">${obj.username}</div>
        // </div>`
        //
        // }
    });

</script>

</body>
</html>